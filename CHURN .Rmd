---
title: "QWE Churn Data Assignment"
author: "Debarati Mazumdar Maura Oray"
date: "10/26/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Introduction**

```{r setup, include=FALSE}

#The required libraries - 
library(dplyr)
library(ggplot2)
library(tidyverse)
library(readxl)

setwd("~/Desktop/BUS-256/MarketingAnalytics") #Set working directory for easier collaboration

```

**2. Data Description & Cleaning**
```{r message=FALSE, warning=FALSE}

qwe <- read_excel("Churn.xlsx", sheet = 2)
summary(qwe)
str(qwe)
dim(qwe)
View(qwe)

#Change categorical variables to factor data type for churn yes - no
qwe[3] <- lapply(qwe[3], factor)
a <- sapply(qwe, function(x) sum(is.na(x)))
a

#Change some variable names

names(qwe)[2]<-paste("age_months")
names(qwe)[3]<-paste("churn")
names(qwe)[4]<-paste("chi_month0")
names(qwe)[5]<-paste("chi_change")
names(qwe)[6]<-paste("sc_month0")
names(qwe)[7]<-paste("sc_change")
names(qwe)[8]<-paste("sp_month0")
names(qwe)[9]<-paste("sp_change")
names(qwe)[10]<-paste("login_change")
names(qwe)[11]<-paste("blog_change")
names(qwe)[12]<-paste("view_change")
names(qwe)[13]<-paste("days_login_change")

```
Below is a description of the following variables:

- Month 0: The starting point, month of December
- 

```{r message=FALSE, warning=FALSE}
# Log for the data which has negative inputs 
qwe$chi_change<- log(qwe$chi_change)
qwe$sc_change <- log(qwe$sc_change)
qwe$login_change <- log(qwe$login_change)
qwe$blog_change <- log(qwe$blog_change)
qwe$view_change <- log(qwe$view_change)
```



```{r message=FALSE, warning=FALSE}

p1 <- ggplot(data = qwe, aes(x= qwe$chi_month0, fill = qwe$churn), position="dodge")+
      ggtitle("CHI with churn month")+
      xlim(0.5,200)+
      # ylim(0, 200)+
      # scale_y_continuous(limits = c(0,5))+
      xlab("Happiness Index") + ylab("December Churn Rate")+
      theme_minimal()+
      geom_bar()
p1

p1 <- ggplot(data = qwe, aes( x= qwe$chi_month0, y =qwe$churn))+
      ggtitle("CHI with churn month")+
      xlim(0.5,200)+
      # ylim(0, 200)+
      # scale_y_continuous(limits = c(0,5))+
      xlab("Happiness Index") + ylab("December Churn Rate")+
      theme_minimal()+
      geom_bar(stat="identity")+
  facet_wrap(~churn)
```


```{r}
# Visualization of Average Churn Rate with customer age 
# Replace missing value with 0 since this is a categorical value variable with 0 and 1 only 
qwe$churn[is.na(qwe$churn)] <- 0
Averagechurn<- mean(qwe$churn == 1)
qwe$churn <- as.factor(qwe$churn)
Averagechurn
p2<- ggplot(data = qwe, aes( x= qwe$age_months, y = Averagechurn))+
     xlim(0,60)+
     #main = " Average Churn Rate vis a vis Customer Age"+
     labs( x = " Customer Age in months"  , y = "Average Churn Rate")+
     geom_bar(stat = "identity" , col = "red" , fill = "blue")
p2

```

```{r}
#Boxplot visualization for churn count by account age

qwe$churn[is.na(qwe$churn)] <- 0
qwe1 <- subset(qwe, qwe$churn== 1)
select = c(qwe$age_months)

p3<- ggplot(data = qwe1, aes(x=churn, y=age_months))+
    geom_boxplot()+
     ggtitle("Churn Customer Count by Age of Account")+
    xlab("Churn: Yes") +
    ylab("Count")
    
p3
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
