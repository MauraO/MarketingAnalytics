---
title: 'Pilgrim Bank Part A: Debarati Mazumdar, Maura Oray'
author: "Debarati Mazumdar, Maura Oray"
date: "9/30/2018"
output: html_document
---

```{r}

#1. Introduction (add intro)


#2. Read in Data

library(ggplot2)
library(dplyr)
library(readxl)
library(forcats)
library(questionr)

bank <- read_excel("~/Desktop/BUS-256/MarketingAnalytics/608715-XLS-ENG.xls", sheet = 2)

#a. Columns and rows

dim(bank) #31634 rows, 11 columns

#b.Select 1999 columns

bank.df <- bank[-c(8:9, 11)] 

```

```{r}

#3. Data Description & Cleaning

#a. Conceptual measure types

summary(bank.df)
str(bank.df) 

```
Before manipulating the data, we checked to see the variable types. All variables in the data set were numeric, but the "conceptual" measure types are as follows: ID (discrete, nominal), Profit (continuous, ratio), Online (discrete, nominal), Age (discrete, ordinal), Income (discrete, ordinal), Tenure (continuous, ratio), District (discrete, nominal), and Bill Pay (discrete, nominal).  

```{r}

#3b-c. NA values and Variable Types

bank.df[3:5] <- lapply(bank.df[3:5], factor)
bank.df[7:8] <- lapply(bank.df[7:8], factor)

bank.df$`9Age`= fct_explicit_na(bank.df$`9Age`, na_level = "8") #Adding level '8' as category for NA age

bank.df$`9Inc`= fct_explicit_na(bank.df$`9Inc`, na_level = "10") #Adding level '10' as category for NA income

#3d. Frequency Tables

table(bank.df$`9Online`, bank.df$`9Billpay`)

prop <- table(bank.df$`9Online`, bank.df$`9Billpay`) %>%
  prop.table()
prop

#3e. New variable: subscription_grp

bank.df <- bank.df %>%
mutate(subscription_grp = case_when(`9Online` == '0' & `9Billpay` == '0' ~ "1",
`9Online` == '1' & `9Billpay` == '0' ~ "2", `9Online` == '1' & `9Billpay` == '1' ~ "3"))

```
As was shown in part 2, all variables were originally stored as numeric. Changing variables such as Online, Age, Income, District, and Bill Pay to factors will make for easier analysis. We also decided to use "8" as the NA category for Age and "10" for the NA category for Income.

In the frequency table, the Online variable is expressed as the rows and the Bill Pay variable as the columns. Unsurprisingly, the majority of customers do not have online banking or bill pay, as is shown by the proportion table (nearly 88%). This seems to suggest that customers who fall in this category are more "traditional" customers, in that they probably visit their local branch to do in-person banking, and are more averse to "new" banking such as online banking and automatic bill pay.

Only about 11% of customers had online banking but not bill pay, suggesting that these customers are most likely amenable to new banking technology, but haven't quite moved to bill pay yet. Because bill pay is most likely online, it is possible that these customers have not yet explored this banking option. Only about 2% of customers had both bill pay and online banking. 

The most interesting observation of the proportion table was that not one customer had bill pay but NOT online banking. This makes sense as bill pay would be a proponent of online banking - meaning that one has to have online banking in order to have bill pay. 

Finally, we created 3 categories for the new variable "subscription_grp". The categories were: "1": customers who do not have online banking or bill pay, "2": customers who have online banking but not bill pay, and "3": customers who have both bill pay and online banking.

```{r}

#4. Visualizations

#Income Distribution & Profitability

ggplot(bank.df, aes(x=`9Inc`, y=`9Profit`)) +
  geom_boxplot() +
  xlab("Income Category") +
  ylab("Profitability") +
  ggtitle("Income and Profitability Distribution")

#Age Distribution & Profitability

ggplot(bank.df, aes(x=`9Age`, y=`9Profit`)) +
  geom_boxplot() +
  xlab("Age Category") +
  ylab("Profitability") +
  ggtitle("Age and Profitability Distribution")

#District Distribution & Profitability

ggplot(bank.df, aes(x=`9District`, y=`9Profit`)) +
  geom_boxplot() +
  xlab("District") +
  ylab("Profitability") +
  ggtitle("District and Profitability Distribution")

#Tenure v. Profitability

ggplot(bank.df, aes(x=`9Tenure`, y=`9Profit`)) +
  geom_point() +
  xlab("Tenure") +
  ylab("Profitability") +
  ggtitle("Tenure and Profitability Distribution")

#Subscription Group & Profitability

ggplot(bank.df, aes(x=subscription_grp, y=`9Profit`)) +
  geom_boxplot() +
  xlab("Subscription Group") +
  ylab("Profitability") +
  ggtitle("Subscription Group and Profitability Distribution")

```

testing