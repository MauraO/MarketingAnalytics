---
title: "eBay Assignment Marketing Analytics"
author: "Debarati Mazumdar, Maura Oray"
date: "10/21/2018"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Introduction*

```{r results='hide', message=FALSE, warning=FALSE}

library(dplyr)
library(ggplot2)
library(tidyverse)
library(randomizeR)

#The required libraries for the case analysis

```


```{r results='hide', message=FALSE, warning=FALSE}

setwd("~/Desktop/BUS-256/MarketingAnalytics") #Set the working directory for easier collaboration
ebay <- read.csv("eBayData.csv")
summary(ebay)
str(ebay)
dim(ebay)

```
Here we see that the data set has 5 variables with 23,730 observations. The minimum revenue is $367, maximum is $2,601,390 with a median of $53,919. 

In terms of the data types, date is a factor, DMA, isTreatmentPeriod and isTreatmentGroup are integers, and revenue is numerical.

*a. Convert the Date Column and Transform Variables*
```{r results='hide', message=FALSE, warning=FALSE}

ebay$rDate <- as.Date(ebay$date, format="%m/%d/%y") 
head(ebay)

#Convert to factors
ebay[3:4] <- lapply(ebay[3:4], factor)

```
In the above code, we added a column called 'rDate' and transformed the date from a factor to a date type.

We also decided to convert the Treatment Period and Treatment Group variables from integers to factors, because the variables are essentially categorical. Converting to factors will make for better statistical analysis and regression.

*b. Determine Treatment Period start date*
```{r results='hide', message=FALSE, warning=FALSE}

ebay_treatment = subset(ebay[order(ebay$rDate),]) #order date
head(ebay_treatment)

ebay_treatment1 = subset(ebay[order(ebay$rDate), ],isTreatmentPeriod == "1") #subset now by treatment period
head(ebay_treatment1)

```
We also found the treatment and pre-treatment periods. The pre-treatment period (0), where both groups were shown ads, starte on 04/01/2012, and the treatment period (1), where control group continued to see ads but the treatment group did not, started on 05/22/2012. Therefore, the treatment group viewed ads for approximately 7 weeks. 

```{r results='hide', message=FALSE, warning=FALSE}

a = table(ebay$isTreatmentGroup, ebay$isTreatmentPeriod)
t = as.data.frame(a)
names(t)[1] = 'Treatment Group' #header for first column
names(t)[2] = 'Treatment Period' #header for second column
t

prop = table(ebay$isTreatmentGroup, ebay$isTreatmentPeriod)
prop.table(prop)
prop

```
We decided to view the categorical data (treatment period and groups) as a frequency table for clearer understanding. As shown above, we can see that 14.6% of the population is in the control group/pre-treatment period (0/0), 17.8% is in the control group/treatment period (0/1), 30.5% is in the treatment group/pre-treatment period (1/0), and finally 37.1% is in the treatment group/treatment period (1/1). We can see that there is a data disparity in the division of groups, as the treatment group is larger.

*c. Regression of Treatment Group and Revenue for pre and post treatment period*
```{r results='hide', message=FALSE, warning=FALSE}

# Understanding the Notations - Control group (0), Treatment group (1). Ads shown to both groups is Treatment Period (0) and only to Control group is Treatment Periond (1)
# Hypothesis for this analysis is : We hypothesize that not showing the ads to the treatment group will not lead to a decrease in revenue from the treatment period when ads were shown to the group
ebay1<- ebay %>%
filter(isTreatmentGroup == 1) 
ebay_log <- lm(log(revenue) ~ isTreatmentPeriod, data = ebay1)
summary(ebay_log)
# The Intercept for the group during the period when ads are shown is 10.94 and for the period when ads are
# not shown is (`10.94 -.03) = 10.91 whcih is a very small insignificant difference.
# Thus, how we read this is for every one ad shown before the treatment period there is $10.94 increase in
# revenue keeping all the other factors constant.
# The intercept 10.94 is true at 99% confidence , and 10.91 at a confidence of 90%
# p value (< 0.05) , thus we can say that we should reject the NULL, and conclude that there is significant decrease in revenue once the ads are not shown to the group.
```

```{r results='hide', message=FALSE, warning=FALSE}
# d.)
# Random Test - paired t -test for Control group and Treatment group 
# NULL Hypothesis will be that the revenue for control group is same as treatment group for pre treatment period 
# NULL Hypothesis will be that the revenue for control group is not the  same as treatment group for treatment period 



# Pre Treatment Period Analysis 
ebay2<- ebay %>%
filter(isTreatmentPeriod == 0)
ebay_pre = lm(log(revenue) ~ isTreatmentGroup , data = ebay2)
summary(ebay_pre)
# Analysis - Intercept slope for Control group for pre treatment period is 10.96 and for Treatment group is slightly less (10.96 - 0.01) = 10.95 , thus for every ad shown to control group & treatment group there is a $10.96 earn in sales.Now we check p value which is >0.05 and this means that NULL is significant and thus we accept NULL.
# R sqaure is very less so this indicates that there is poor goodness of fit, indicating that the values are pretty scattered and do not fall on the regression slope line.

```

```{r results='hide', message=FALSE, warning=FALSE}
# e.) post treatment data to check the effectiveness of ads with and without DMA
# Part I 
ebay$dma <- as.numeric(ebay$dma)
ebay5<- ebay %>%
filter(isTreatmentPeriod == 1)
ebay_dma = lm(log(revenue) ~  dma + isTreatmentGroup , data = ebay5)
summary(ebay_dma)
#Part II
ebay4<- ebay %>%
filter(isTreatmentPeriod == 1)
ebay_dma1 = lm(log(revenue) ~  isTreatmentGroup  , data = ebay4)
summary(ebay_dma1)

# Analysis for part I we can say that whne we include the dma as an independent variable, we observe the intercept for Control group is (12.31-0.002) and for treatment group is ( 12.31 -.007), which indicates that there is no signifiacnt differnce with dma as a factor.Now when we observe p value <0.05 , thus NULL is not significant and we have to reject NULL.
# This is pretty unusal but it is possible as even though there is an insignificant difference , this can multiply to a larger value when the population for the groups increase.
```

```{r results='hide', message=FALSE, warning=FALSE}
# f) Log is taken for revenue as it reduced the skewness in the variables and the results. If we observe the min  is $367 and max value of revenue is $ 2601390. Thus we see a huge band and chances of data being skewed is likely. 
# Alos if we take the regression with simple revenue the intercept value is very large and the p value is very large . This tends the analysis to be incorrect.

# g) Effectiveness of Advertising - Conclusion  
# For this dataset we can conclude that advertisements can be effective in increasing sales for a company but the sample chosen for the ads should be the correct representation of the total population. 
# From the tests in the analysis we can say that the ads were effective and customer actually got influenced in buying the product/ service. The Control group also tells us the exact sample of data and as a company we can study the consumer behaviour and profile such customers as "people with similar buying patterns"

```


